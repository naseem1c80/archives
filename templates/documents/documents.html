{% extends "layouts/base.html" %}

{% block title %} Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}


  
    <!-- [ Main Content ] start -->
    <section class="pcoded-main-container">
        <div class="pcoded-content">
            <!-- [ breadcrumb ] start -->
            <div class="page-header">
                <div class="page-block">
                    <div class="row align-items-center">
                        <div class="col-md-12">
                            <div class="page-header-title">
                                <h5 class="m-b-10">
                                     Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª  
                                </h5>
                            </div>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/"><i class="feather icon-home"></i></a></li>
                                <li class="breadcrumb-item"><a href="#"> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª  </a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- [ breadcrumb ] end -->
            <!-- [ Main Content ] start -->
            <div class="row">
                <!-- [ basic-table ] start -->
                <div class="col-md-18">
                    <div class="card">
                        <div class="card-header">
                         

                                <div class="card-header d-flex justify-content-between align-items-center " dir="rtl">
    <h5>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª   
                            </h5>
      <a href="/create_document" class="btn btn-success" target="_blank" onlick="openAddModal()">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ†Ø¯</a>
    </div>
                           
                        </div>
                        <div class="card-body table-border-style">
                             
        <!-- ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ø­Ø« -->
        <div class="search-box p-3 mb-4">
            <div class="row g-2">
                <div class="col-md-3">
                    <input type="text" id="searchInput" class="form-control" placeholder="ğŸ” Ø§Ø¨Ø­Ø«...">
                </div>
                <div class="col-md-2">
                    <select id="document_type" class="form-select" onchange="change_document_type(this)">
                        <option value="0">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                        <option value="1">ØªÙ‚Ø±ÙŠØ±</option>
                        <option value="2">Ø¹Ù‚Ø¯</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="date" id="docDate" class="form-control date-input">
                </div>
                <div class="col-md-2">
                    <select id="docStatus" class="form-select" onchange="change_document_status(this)">
                        <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="1">Ù…ØªØ­Ù‚Ù‚</option>
                        <option value="0">ØºÙŠØ± Ù…ØªØ­Ù‚Ù‚</option>
                            <option value="2">Ù…Ø±ØªØ¬Ø¹ </option>
                    </select>
                </div>
                <div class="col-md-3 d-grid">
                    <button class="btn btn-primary" id="refreshBtn">
                        <i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            </div>
        </div>



    <div class="table-responsive">
<table
  id="table"
  class="table table-striped table-bordered"
  dir="rtl"
  data-toggle="table"
  data-ajax="ajaxRequest"
  data-pagination="true"
  data-side-pagination="server"
  data-page-list="[10, 20, 50, 100]"
  data-search="true"
  data-show-refresh="true"
  data-show-toggle="true"
  data-sort-name="id"
  data-sort-order="asc"
>
                            <thead>
                            <tr>

     <!-- <table class="table table-bordered table-striped text-center"  dir="rtl" id="mainTable">
        <thead class="table-success">
          <tr>-->

							
                           
                                <th class="text-center py-1 px-2"
                                data-field="id" data-align="center"
                                data-sortable="true">ID</th>
                                

            <th  data-field="name" data-sortable="true">Ø§Ù„Ø§Ø³Ù… </th>
            <th data-field="number_doc" data-sortable="true">Ø±Ù‚Ù… Ø§Ù„Ø³Ù†Ø¯</th>
            <th data-field="transfer_number" data-sortable="true">Ø±Ù‚Ù… Ø§Ù„Ø­ÙˆØ§Ù„Ø©</th>
             <th data-field="account_number" data-sortable="true"> Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</th>
            <th data-field="sender_name" data-align="center"
                                data-sortable="true"> Ø§Ù„Ù…Ø±Ø³Ù„</th>
             <th data-field="recipient_name" data-align="center"
                                data-sortable="true"> Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
            <th data-field="user_name" data-align="center"
                                data-sortable="true"> Ø§Ù„Ù…ÙˆØ¸Ù</th>
            <th data-field="branch_name" data-align="center"
                                data-sortable="true"> Ø§Ù„ÙØ±Ø¹</th>
            <th data-field="status" data-align="center" class="text-center py-1 px-2"
                                data-sortable="true">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                 <th class="text-center py-1 px-2" data-field="created_at" data-align="center"
                                data-sortable="true">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th data-align="center"     data-formatter="getactiondocument"
 width="100px"  class="text-center py-1 px-2"> action
</th>
						
                         
          </tr>
        </thead>
        <!--<tbody id="userTable"></tbody>-->
      </table>
   
   <!-- Pagination -->

    





<script>

      window.getactiondocument = (value, row) => {
   // function getactiondocument(value,row,index){
			    
			    return [`<div style="width:140px"><button class="btn btn-sm btn-primary"
			    onclic="openEditModal(${row['id']}, '${row['name']}', '${row['number_doc']}',
			    '${row['role']}')"> <i class="feather icon-edit"></i></button>
              <button class="btn btn-sm btn-danger"
              onclick="delete_document(${row['id']})"> <i class="feather icon-trash"></i></button> 
              <button class="btn btn-sm btn-success view-profile-btn" data-id="${row['id']}"   > <i class="feather icon-eye"></i></button></div>`];
			}
</script>

<script>
  var document_type = 0;
<<<<<<< HEAD
 var document_status="";
=======
 var document_status ;
>>>>>>> 3c0cde345fc5750a02e75dfa5fa038400ff58a12
 
let documents_type=[];
    loaddocuments_type();

async function loaddocuments_type() {
    const doctypSelect = document.getElementById('document_type');
   
    
    try {
      if(users.length<1){
            doctypSelect.innerHTML = '<option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>';
      const response = await fetch("{{ url_for('documents_blueprint.getdocument_types') }}"); // ØºÙŠÙ‘Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ø­Ø³Ø¨ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
       documents_type = await response.json();

      }
      // Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
      doctypSelect.innerHTML  = '';
      documents_type.forEach(user => {
        const option = document.createElement('option');
        option.value = user.id; // Ø£Ùˆ branch.code Ø­Ø³Ø¨ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        option.textContent = user.name;
        doctypSelect.appendChild(option);
      });
    } catch (error) {
      doctypSelect.innerHTML = '<option value="">ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</option>';
     showError('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:');
      console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ù‚Ø³Ø§Ù…:', error);
    }
  }
  function change_document_type(e) {
    document_type = e.value;
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
    $('#table').bootstrapTable('refresh'); 
  }


  function change_document_status(e) {
    document_status = e.value;
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©
    $('#table').bootstrapTable('refresh'); 
  }

  
  window.ajaxRequest = function (params) {
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø£Ù†Ø´Ø¦ ÙƒØ§Ø¦Ù† data
    if (!params.data) {
      params.data = {};
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯
    if (document_type > 0) {
      params.data['document_type'] = document_type;
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯
    if (document_status.length>0) {
      params.data['status'] = document_status;
    }

    const url = "{{ url_for('documents_blueprint.getdocuments') }}";

    // ØªÙ†ÙÙŠØ° Ø§Ù„Ø·Ù„Ø¨
    $.get(`${url}?${$.param(params.data)}`).then(function (res) {
      // ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ bootstrap-table
      params.success(res);
    }).catch(function (err) {
      console.error("Error fetching documents:", err);
    });
  };
</script>
<script>/*
    var document_type=0;
  // your custom ajax request here
  function change_document_type(e){
    alert(e.value);
    ajaxRequest();
  }
  window.ajaxRequest = params => {
    const url = "{{url_for('documents_blueprint.getdocuments') }}"

if(document_type>0){
    params.data['document_type']=document_type;
}
alert(JSON.stringify(params));
    $.get(`${url}?${$.param(params.data)}`).then(function (res) {
      params.success(res)
    })
  }*/
</script>
   
   
                            </div>
                        </div>
                    </div>
                </div>
              
           
             
               
          
            </div>
            <!-- [ Main Content ] end -->
        </div>
    </section>
    <!-- [ Main Content ] end -->

<!-- Modal -->
<div class="modal fade" id="documentModal" tabindex="-1" aria-labelledby="documentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="documentModalLabel">Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
      </div>
      <div class="modal-body" id="documentModalBody">
        <!-- ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ù‡Ù†Ø§ -->
        <div class="text-center p-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
      </div>
    </div>
  </div>
</div>


<script>
$(document).on('click', '.view-profile-btn', function () {
    const docId = $(this).data('id');
    $('#documentModalBody').html('<div class="text-center p-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>');

    $.get('/document/' + docId, function (html) {
        $('#documentModalBody').html(html);
        $('#documentModal').modal('show');
    }).fail(function () {
        $('#documentModalBody').html('<div class="alert alert-danger">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>');
    });
});
</script>
    <script sr="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

     <script>
       
       let currentPage = 1;
    let limit = 10;
    let data = [];
    let sortBy = 'id';
    let sortOrder = 'asc'; // or 'desc'
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const appConfig = {
            apiUrl: "{{ url_for('documents_blueprint.getdocuments') }}",
            token: 'Bearer your_token_here',
            pageSize: 10
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        $(document).ready(function() {
            //initEventListeners();
            //loadData(1);
        });

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function initEventListeners() {
            $('#refreshBtn').click(loadData);
            $('#searchInput').on('input', debounce(function(){
              loadData(1);}, 300));
            $('.form-control, .form-select').change(function(){
              loadData(1);});
        }



        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙ„Ø§ØªØ±
        function getFilters(offset=0) {
            return {
                search: $('#searchInput').val(),
                type: $('#docType').val(),
                date: $('#docDate').val(),
                status: $('#docStatus').val(),
                limit: limit,
                offset:offset,
                sort_by:sortBy,
                sort_order:sortOrder
            };
        }
        
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function showLoading() {
            $('#loading').show();
        }

        function hideLoading() {
            $('#loading').hide();
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
       /* function showError(message) {
            $('#mainTable tbody').html(`
                <tr>
                    <td colspan="5" class="text-center text-danger py-4">
                        âš ï¸ ${message}
                    </td>
                </tr>
            `);
        }*/

        // Ù…Ù†Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }
        
        function renderPagination(total, limit, currentPage) {
        const totalPages = Math.ceil(total / 10);
        const pagination = document.getElementById("paginationControls");
        pagination.innerHTML = "";

        for (let i = 1; i <= totalPages; i++) {
            const li = document.createElement("li");
            const btn = document.createElement("button");
            btn.innerText = i;
            if (i === currentPage) btn.classList.add("active");
            btn.onclick = () => {
              loadData(i);
               // fetchDocuments(i);
            };
            li.appendChild(btn);
            pagination.appendChild(li);
        }
    }
    </script>

<script>
   
  

  function delete_document(id) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ù†Ø¯ØŸ")) {
      axios.post(`/documents/${id}/delete`).then(() => loadData(1));
    }
  }

//  window.onload = loadData;
</script>
{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}{% endblock javascripts %}
