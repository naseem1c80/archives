{{user.permissions}}
<style>
.permission-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 12px;
    margin-top: 10px;
}
.permission-item {
    display: flex;
    align-items: center;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
}
.permission-item:hover {
    background: #e9ecef;
    border-color: #007bff;
}
.permission-item input[type="checkbox"] {
    margin-right: 10px;
    transform: scale(1.2);
}
.permission-item label {
    margin: 0;
    cursor: pointer;
    font-weight: 500;
}
.permission-category {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #007bff;
}
.permission-category h6 {
    margin-bottom: 15px;
    color: #2c3e50;
    font-weight: 600;
}
</style>


<!-- [ Main Content ] start -->
<section class="pcoded-main-container">
    <div class="pcoded-content">
      <h1>
        {{user.full_name}}
      </h1>
        <!-- [ breadcrumb ] start -->
        <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-12">
                        <div class="page-header-title">
                            <h5 class="m-b-10">إدارة صلاحيات الموظفين</h5>
                        </div>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/"><i class="feather icon-home"></i></a></li>
                            <li class="breadcrumb-item"><a href="#">صلاحيات الموظفين</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        
        <!-- [ Main Content ] start -->
        <div class="row">
            <div class="col-lg-6">
                <!-- بطاقة إضافة صلاحية جديدة -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-white border-0 py-3">
                        <h5 class="mb-0 text-primary font-weight-bold" id="form-title">
                            <i class="feather icon-plus-circle me-2"></i>
                            إضافة صلاحية جديدة
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="permission-form" onsubmit="savePermission(event)">

                            
                            <div class="mb-4">
                                <label class="form-label fw-bold text-gray-700 mb-3">الصلاحيات المتاحة</label>
                                
                                <!-- فئة إدارة المستخدمين -->
                                <div class="permission-category">
                                    <h6><i class="fas fa-users me-2"></i>إدارة المستخدمين</h6>
                                    <div class="permission-grid">
                                        <div class="permission-item">
                                            <input type="checkbox" id="users" value="users">
                                            <label for="users">عرض المستخدمين</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="add_user" value="add_user">
                                            <label for="add_user">إضافة مستخدم</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="edit_user" value="edit_user">
                                            <label for="edit_user">تعديل المستخدمين</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="delete_user" value="delete_user">
                                            <label for="delete_user">حذف المستخدمين</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- فئة إدارة المستندات -->
                                <div class="permission-category">
                                    <h6><i class="fas fa-file-alt me-2"></i>إدارة المستندات</h6>
                                    <div class="permission-grid">
                                        <div class="permission-item">
                                            <input type="checkbox" id="add_document" value="add_document">
                                            <label for="add_document">إضافة مستند</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="edit_document" value="edit_document">
                                            <label for="edit_document">تعديل المستندات</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="delete_document" value="delete_document">
                                            <label for="delete_document">حذف المستندات</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="verify_document" value="verify_document">
                                            <label for="verify_document">التحقق من المستندات</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="approve_documents" value="approve_documents">
                                            <label for="approve-documents">اعتماد المستندات</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- فئة إدارة النظام -->
                                <div class="permission-category">
                                    <h6><i class="fas fa-cogs me-2"></i>إدارة النظام</h6>
                                    <div class="permission-grid">
                                        <div class="permission-item">
                                            <input type="checkbox" id="add_branch" value="add_branch">
                                            <label for="add_branch">إدارة الفروع</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="add_document_types" value="add_document_types">
                                            <label for="add_document_types">إدارة أنواع المستندات</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="manage_archive" value="manage_archive">
                                            <label for="manage_archive">إدارة الأرشيف</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="manage_settings" value="manage_settings">
                                            <label for="manage-settings">إدارة الإعدادات</label>
                                        </div>
                                    </div>
                                </div>

                                <!-- فئة التقارير والإحصائيات -->
                                <div class="permission-category">
                                    <h6><i class="fas fa-chart-bar me-2"></i>التقارير والإحصائيات</h6>
                                    <div class="permission-grid">
                                        <div class="permission-item">
                                            <input type="checkbox" id="view_reports" value="view_reports">
                                            <label for="view_reports">عرض التقارير</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="export_data" value="export_data">
                                            <label for="export_data">تصدير البيانات</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button type="submit" id="save-permission-btn" class="btn btn-primary px-4">
                                    <i class="fas fa-save me-2"></i>
                                    <span id="save-button-text">حفظ الصلاحية</span>
                                    <div id="save-spinner" class="spinner-border spinner-border-sm ms-2" style="display: none;"></div>
                                </button>
                                <button type="button" id="cancel-edit-btn" class="btn btn-outline-secondary px-4" style="display: none;" onclick="cancelEdit()">
                                    <i class="fas fa-times me-2"></i>
                                    إلغاء التعديل
                                </button>
                                <button type="button" class="btn btn-outline-info px-4" onclick="selectAllPermissions()">
                                    <i class="fas fa-check-square me-2"></i>
                                    تحديد الكل
                                </button>
                                <button type="button" class="btn btn-outline-warning px-4" onclick="deselectAllPermissions()">
                                    <i class="fas fa-times-circle me-2"></i>
                                    إلغاء الكل
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>


        </div>
        <!-- [ Main Content ] end -->
    </div>
</section>
<script>
const userId = {{ user.id }};

// تحميل الصلاحيات عند فتح الصفحة
//document.addEventListener("DOMContentLoaded", () =>
function getpermissions(id){
  //alert("5y");
    fetch(`/user/${id}/permissions`)
        .then(res => res.json())
        .then(data => {
            if (data.status === "success") {
                const userPermissions = data.permissions;

                // تحديد المربعات حسب الصلاحيات
                userPermissions.forEach(p => {
                    const checkbox = document.querySelector(`input[value="${p}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
        });
}


// حفظ الصلاحيات
function savePermission(event) {
    event.preventDefault();

    const checkboxes = document.querySelectorAll('.permission-item input[type="checkbox"]');
    let permissions = [];

    checkboxes.forEach(ch => {
        if (ch.checked) permissions.push(ch.value);
    });

    // إرسال البيانات للسيرفر
    fetch(`/user/${userId}/permissions`, {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ permissions: permissions })
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            alert("تم حفظ صلاحيات المستخدم بنجاح");
        }
    });
}


// تحديد الكل
function selectAllPermissions() {
    document.querySelectorAll('.permission-item input[type="checkbox"]').forEach(cb => cb.checked = true);
}

// إلغاء الكل
function deselectAllPermissions() {
    document.querySelectorAll('.permission-item input[type="checkbox"]').forEach(cb => cb.checked = false);
}
</script>

<!-- [ Main Content ] end -->
